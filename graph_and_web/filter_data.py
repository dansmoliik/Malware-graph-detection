import sys
from os import path
import properties

def read_and_filter_file(file_name, src_ip_address):
    with open(file_name, "r") as f:
        file_content = ""
        f.readline()
        for line in f:
            ip_address = line.split(",")[properties.SRC_ADDR_I]
            if ip_address == src_ip_address:
                file_content += line
    return file_content


def create_filtered_data_file_name(file_name):
    return file_name.split(".binetflow")[0] + "_filtered.binetflow"


def save_filtered_data(file_name, data):
    with open(file_name, "w") as f:
        f.write(data)

if __name__ == "__main__":
    if len(sys.argv) == 3:
        file_name = path.join("data", sys.argv[1])
        ip_address = sys.argv[2]
        filtered_data = read_and_filter_file(file_name, ip_address)
        new_file_name = file_name = create_filtered_data_file_name(file_name)
        save_filtered_data(new_file_name, filtered_data)
        print "Filtered data saved\n"
    else:
        print "There should be 2 input arguments:\n" \
              "name of .binetflow (with file extension) file (from \"data\" directory)\n" \
              "and an IP address.\n"
