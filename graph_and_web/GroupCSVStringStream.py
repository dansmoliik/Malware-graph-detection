import sys
from other_functions import console_print


class StringStream:
    def __init__(self):
        self.is_on = True
        self.data = ""
        self.error = ""
        self.got_info_line = False

    def turn_off(self):
        self.is_on = False
        sys.stdout = sys.__stdout__

    def on_not_normal_exit(self):
        console_print(self.error)

    def write(self, s):
        if s:
            if s.startswith("Error"):
                self.error = s
            if not self.got_info_line:
                self.data += str(s)
                self.got_info_line = True
            else:
                self.data += str(s.split()[1])

    def __enter__(self):
        sys.stdout = self
        return self

    def __exit__(self, ext_type, exc_value, traceback):
        if self.is_on:
            self.turn_off()
