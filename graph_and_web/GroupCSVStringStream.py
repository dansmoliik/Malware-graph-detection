import sys
from other_functions import console_print


class GroupCSVStringStream:
    def __init__(self):
        self.data = ""
        self.error = ""
        self.got_info_line = False
        self.prev_stdout = sys.stdout

    def turn_off(self):
        sys.stdout = self.prev_stdout

    def turn_on(self):
        sys.stdout = self

    def write_std(self, s):
        self.turn_off()
        console_print(s)
        self.turn_on()

    def write(self, s):
        if s:
            if s.startswith("Error"):
                self.error = s
            if not self.got_info_line:
                self.data += str(s)
                self.got_info_line = True
            else:
                self.data += str(s.split("\n")[1]) + "\n"

    def __enter__(self):
        self.turn_on()
        return self

    def __exit__(self, ext_type, exc_value, traceback):
        self.turn_off()
        console_print(self.error)
